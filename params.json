{"name":"AFK","tagline":"","body":"17 October 2013\r\n### A nuts 'n' bolts update\r\n\r\nI've pushed a heap of changes that make the shape shader use the 3D textures directly for colours and normals, and removed the flattened-to-2D versions.  The result doesn't look any different, but it should clear the way for a more sophisticated edge detector that can generate extra triangles to fill in those pesky gaps.\r\n\r\nJigsaw-out-of-room errors should be rarer now, too.\r\n\r\n***\r\n\r\n11 October 2013\r\n### Video footage\r\n\r\nFor demo videos of AFK, showing its progress.  https://www.youtube.com/user/KaiEkkrin\r\n\r\n***\r\n\r\n11 October 2013\r\n### A little background\r\n\r\nHow much art can you make without making any art?\r\n\r\nWell, that's what I figured I'd explore with AFK.  It uses a pseudo-random number generator (the rather nice `boost::random::taus88`) and splits the world into cubic cells.  The seed that determines the contents of each cell is a combination of the cell co-ordinates and a master seed generated or supplied at start-up.\r\n\r\nThere's plenty of scope for tweaking what is done with the random numbers, but all the actual detail you see is generated on the fly.  It's cached, rather than built up front (because AFK's worlds are much too large to hold in memory), or wholly generated for each frame (because that would be too slow).\r\n\r\nAlong the way AFK does some other interesting things:\r\n\r\n- Rather than having fixed detail settings, it measures how long it's taking to generate each frame and adjusts the detail accordingly, aiming for a frame rate between 30-60 frames/second.  (The algorithm is a little over-damped right now, causing the frame rate and level of detail to oscillate.  I'm working on it.)\r\n- The amount of detail is theoretically infinite, although in practice it's limited by the amount of precision that can be represented by the int64_t world co-ordinates (and their conversion to float).\r\n- The world enumeration runs across many CPU threads (currently up to 64), using a queueing system in place of a recursive call to drill down through the world tree.\r\n- Because OpenGL implementations (especially AMD's) run slowly when fed a large number of draw calls, AFK draws the landscape and all the visible shapes in just a couple of calls, using instancing with a large buffer texture to produce the desired geometry.\r\n- Random world features are generated in OpenCL, then passed to OpenGL for drawing.  AFK supports CL-GL buffer sharing, but it's disabled by default, because I've yet to find a GPU on which it's a performance improvement.  Instead, I allocate a small number of very large textures mirrored between the OpenCL and OpenGL (the \"jigsaws\").  Each frame, rectangular areas are allocated to contain the new computation tasks for the OpenCL, and these rectangles are copied to the OpenGL after completion.  (Again, for performance, the number of calls needs to be minimised.)\r\n- Generated world detail is cached in the lockless hash map structure `AFK_Polymer`.  I created this structure rather than using `std::unordered_map` with a lock because each frame, the world enumeration needs to do a very large number of concurrent lookups.  In this situation, my custom structure's benefit (I measured a 10x higher lookup rate vs. `std::unordered_map` with a lock on an 8-thread system) outweighs its drawback (it occasionally generates more than one value for the same key).\r\n\r\nThe small blue chevron that serves as \"protagonist\" right now is a cheat, because I encoded its geometry by hand.  I'll remove it as soon as I can generate a random shape that fits its place nicely.\r\n\r\n***\r\n\r\n11 October 2013\r\n### AFK's first upload\r\n\r\nWow, it's in a bit of a strange state right now, isn't it?  All those holes in the objects?  Yeah, that's because I'm deforming single cubes to fit the shapes, and it runs out of triangles in the cube to fit.  I've actually got a local branch right now where I'm working on a fix to enable the geometry shader to generate the additional faces.  It'll be up in a week or two, I hope.\r\n\r\nBut art is never finished, only abandoned, so I figured I'd go public right now just in case :).\r\n\r\nAfter that, I should really make an effort to get it to build on Windows.  I know that half my mates can't run my ~~useless~~ wonderful project because they don't have a GNU/Linux install.\r\n\r\nThe current defaults betray the Tetris-like skeletons of the default shapes a bit much, by the way.  Try this:\r\n\r\n```\r\n./build/release/afk --shape-edge-threshold 0.05\r\n```\r\n\r\nfor something less...  cuboid.","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}